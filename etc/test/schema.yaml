schemas:
  main:
    tables:
      test_table:
        display_name: テストテーブル
        fields:
          - column_name: col_id
            display_name: IDカラム
            column_type: varchar(36)
            nullable: false
            primary_key: 1
          - column_name: name
            display_name: 名前
            column_type: varchar(100)
            nullable: false
            charset: utf8mb4
            collation: utf8mb4_unicode_ci
          - column_name: num
            display_name: 数字
            column_type: int
            nullable: true
          - column_name: update_date
            display_name: 更新日時
            column_type: datetime
            nullable: false
          - column_name: update_user
            display_name: 更新者
            column_type: varchar(64)
            nullable: false
            charset: utf8mb4
            collation: utf8mb4_unicode_ci

      tbl_child:
        display_name: 子テーブル
        fields:
          - column_name: child_id
            display_name: 子ID
            column_type: varchar(36)
            nullable: false
            primary_key: 1
          - column_name: col_id
            display_name: IDカラム
            column_type: varchar(36)
            nullable: false
            foreign_key: test_table.col_id
          - column_name: name
            display_name: 名前
            column_type: varchar(100)
            nullable: false
          - column_name: update_date
            display_name: 更新日時
            column_type: datetime
            nullable: false
          - column_name: update_user
            display_name: 更新者
            column_type: varchar(64)
            nullable: false

      properties:
        display_name: プロパティ
        fields:
          - column_name: key
            display_name: キー
            column_type: varchar(32)
            nullable: false
            primary_key: 1
          - column_name: value
            display_name: 値
            column_type: varchar(64)
            nullable: false
          - column_name: update_date
            display_name: 更新日時
            column_type: datetime
            nullable: false
          - column_name: update_user
            display_name: 更新者
            column_type: varchar(64)
            nullable: false

      row_table:
        display_name: 行テーブル
        fields:
          - column_name: row_id
            display_name: ID
            column_type: varchar(36)
            nullable: false
            primary_key: 1
          - column_name: row_name
            display_name: 名前
            column_type: varchar(64)
            nullable: false

      tbl_matrix:
        display_name: マトリックステーブル
        fields:
          - column_name: row_id
            display_name: ID
            column_type: varchar(36)
            nullable: false
            primary_key: 1
            foreign_key: row_table.row_id
          - column_name: child_id
            display_name: 子ID
            column_type: varchar(36)
            nullable: false
            primary_key: 2
            foreign_key: tbl_child.child_id
          - column_name: value
            display_name: 値
            column_type: varchar(20)
            nullable: false
          - column_name: update_date
            display_name: 更新日時
            column_type: datetime
            nullable: false
          - column_name: update_user
            display_name: 更新者
            column_type: varchar(64)
            nullable: false

      tbl_cmp_table:
        display_name: 複合キーテーブル
        fields:
          - column_name: col_id
            display_name: IDカラム
            column_type: varchar(36)
            nullable: false
            primary_key: 1
            foreign_key: test_table.col_id
          - column_name: seq
            display_name: シーケンス
            column_type: int
            nullable: false
            primary_key: 2
          - column_name: name
            display_name: 名前
            column_type: varchar(64)
            nullable: false

      tbl_cmp_child:
        display_name: 複合子テーブル
        fields:
          - column_name: cmp_child_id
            display_name: 複合キー子ID
            column_type: varchar(36)
            nullable: false
            primary_key: 1
          - column_name: col_id
            display_name: IDカラム
            column_type: varchar(36)
            nullable: false
            # Note: Complex foreign key reference (col_id,seq) -> tbl_cmp_table(col_id,seq)
          - column_name: seq
            display_name: シーケンス
            column_type: int
            nullable: false
          - column_name: name
            display_name: 名前
            column_type: varchar(64)
            nullable: false

      tbl_null_test:
        display_name: tbl_null_test
        fields:
          - column_name: test_id
            display_name: test_id
            column_type: varchar(36)
            nullable: false
            primary_key: 1
          - column_name: col1
            display_name: col1
            column_type: char(5)
            nullable: true
          - column_name: col2
            display_name: col2
            column_type: varchar(10)
            nullable: true
          - column_name: col3
            display_name: col3
            column_type: datetime
            nullable: true
          - column_name: col4
            display_name: col4
            column_type: int
            nullable: true

      # Expression column examples
      users:
        display_name: ユーザー
        fields:
          - column_name: id
            display_name: ID
            column_type: BIGINT
            nullable: false
            primary_key: 1
            auto_increment: true
            
          - column_name: first_name
            display_name: 名
            column_type: VARCHAR(50)
            nullable: false
            charset: utf8mb4
            collation: utf8mb4_unicode_ci
            
          - column_name: last_name
            display_name: 姓
            column_type: VARCHAR(50)
            nullable: false
            charset: utf8mb4
            collation: utf8mb4_unicode_ci
            
          - column_name: email
            display_name: メールアドレス
            column_type: VARCHAR(255)
            nullable: false
            charset: utf8mb4
            collation: utf8mb4_unicode_ci
            
          - column_name: birth_date
            display_name: 生年月日
            column_type: DATE
            nullable: true
            
          - column_name: full_name
            display_name: フルネーム
            column_type: VARCHAR(101)
            nullable: false
            expression: "CONCAT(last_name, ' ', first_name)"
            stored: true
            
          - column_name: email_domain
            display_name: メールドメイン
            column_type: VARCHAR(255)
            nullable: true  
            expression: "SUBSTRING_INDEX(email, '@', -1)"
            stored: false
            
          - column_name: age
            display_name: 年齢
            column_type: INT
            nullable: true
            expression: "TIMESTAMPDIFF(YEAR, birth_date, CURDATE())"
            stored: false
            
          - column_name: created_at
            display_name: 作成日時
            column_type: TIMESTAMP
            nullable: false
            default_value: "CURRENT_TIMESTAMP"
            
        indexes:
          - index_name: idx_email
            columns: [email]
          - index_name: idx_full_name
            columns: [full_name]
            
      products:
        display_name: 商品
        fields:
          - column_name: id
            display_name: ID
            column_type: BIGINT
            nullable: false
            primary_key: 1
            auto_increment: true
            
          - column_name: name
            display_name: 商品名
            column_type: VARCHAR(255)
            nullable: false
            charset: utf8mb4
            collation: utf8mb4_unicode_ci
            
          - column_name: price
            display_name: 単価
            column_type: DECIMAL(10,2)
            nullable: false
            
          - column_name: tax_rate
            display_name: 税率
            column_type: DECIMAL(5,4)
            nullable: false
            default_value: "0.1000"
            comment: "デフォルト10%の消費税"
            
          - column_name: total_price
            display_name: 税込価格
            column_type: DECIMAL(10,2)
            nullable: false
            expression: "price * (1 + tax_rate)"
            stored: true
            comment: "税込み適用後の価格"
            
          - column_name: price_category
            display_name: 価格帯
            column_type: VARCHAR(20)
            nullable: false
            expression: "CASE WHEN price < 1000 THEN '低価格' WHEN price < 5000 THEN '中価格' ELSE '高価格' END"
            stored: false
            charset: utf8mb4
            collation: utf8mb4_unicode_ci
            
        indexes:
          - index_name: idx_name
            columns: [name]
          - index_name: idx_price
            columns: [price]

    views:
      user_summary:
        display_name: ユーザー集計ビュー
        select_statement: |
          SELECT 
            u.id,
            u.full_name,
            u.email,
            u.age,
            COUNT(o.id) as order_count,
            COALESCE(SUM(o.total_amount), 0) as total_spent
          FROM users u
          LEFT JOIN orders o ON u.id = o.user_id
          GROUP BY u.id, u.full_name, u.email, u.age
        comment: ユーザーごとの注文集計情報を表示

      active_products:
        display_name: アクティブ商品ビュー
        select_statement: |
          SELECT 
            p.id,
            p.name,
            p.price,
            p.total_price,
            p.price_category,
            p.created_at
          FROM products p
          WHERE p.price > 0
        comment: 価格が設定された商品のみを表示

      test_summary:
        display_name: テストデータ集計ビュー
        select_statement: |
          SELECT 
            t.col_id,
            t.name as test_name,
            COUNT(c.child_id) as child_count,
            MAX(c.update_date) as last_child_update
          FROM test_table t
          LEFT JOIN tbl_child c ON t.col_id = c.col_id
          GROUP BY t.col_id, t.name
        comment: テストテーブルと子テーブルの集計情報